# 數據確認功能 - Data Review Feature

## 功能概述

在使用 `/analyze` 命令時，系統會在將數據送給 AI 分析**之前**，先顯示一個數據確認界面，讓您：

✅ **查看原始數據** - 檢視技術面、基本面、法人動向數據
✅ **添加補充資訊** - 加入新聞、觀察、特殊事件等
✅ **確認後送出** - 確保 AI 分析時包含您的見解
✅ **隨時取消** - 不滿意可直接取消分析

## 使用流程

### 1. 執行分析命令
```bash
/analyze 2330
```

### 2. 系統自動獲取數據
```
📊 正在分析 2330...

⏳ 步驟 1/3: 獲取股票資料
✅ 股票資料已取得
⏳ 步驟 2/3: 分析技術面、基本面、法人動向
✅ 技術指標分析完成
```

### 3. 數據確認界面彈出

界面顯示：

```
┌─────────────────────────────────────────────┐
│           📊 2330 數據確認                    │
├─────────────────────────────────────────────┤
│                                             │
│ 📈 股票基本資訊                              │
│ ══════════════════════════════════════════  │
│ 代碼: 2330                                  │
│ 名稱: 台積電                                │
│ 當前價格: NT$ 585.00                         │
│ 漲跌: +5.00 (+0.86%)                        │
│ 成交量: 25,000,000                          │
│                                             │
│ 📊 技術面分析                                │
│ ══════════════════════════════════════════  │
│ 趨勢: 上升                                  │
│ RSI: 62.5 (中性)                            │
│ MACD: 多頭                                  │
│ 支撐: NT$ 570.00                            │
│ 壓力: NT$ 600.00                            │
│                                             │
│ 💼 基本面分析                                │
│ ══════════════════════════════════════════  │
│ P/E: 18.5                                   │
│ ROE: 25.3%                                  │
│ ...                                         │
│                                             │
│ 🏦 法人動向                                  │
│ ══════════════════════════════════════════  │
│ 外資買賣超: +15,000 張                       │
│ 投信買賣超: +2,500 張                        │
│ ...                                         │
│                                             │
├─────────────────────────────────────────────┤
│ 💬 補充說明（選填）                          │
│ ┌─────────────────────────────────────────┐ │
│ │ [在此輸入您的補充資訊]                    │ │
│ │ 例如：                                   │ │
│ │ - 今日新聞：台積電宣布擴廠計畫            │ │
│ │ - 個人觀察：外資連續買超3天               │ │
│ │ - 產業動態：AI 需求持續強勁              │ │
│ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│        [✅ 確認送出]      [❌ 取消]           │
└─────────────────────────────────────────────┘

提示：
- 在文字框中添加補充資訊
- 按 Ctrl+Enter 確認送出
- 按 Esc 取消分析
```

### 4. 添加補充說明（選填）

在文字框中輸入您的補充資訊：

**範例 1：加入新聞**
```
今日重要新聞：
- 台積電宣布 3nm 製程良率提升至 85%
- 蘋果追加 A17 晶片訂單
- 美系外資上調目標價至 650 元
```

**範例 2：加入觀察**
```
個人觀察：
- 近 5 日外資連續買超，累計 8 萬張
- 今日盤中突破 580 壓力，量能放大
- 技術面呈現多頭排列
```

**範例 3：加入事件**
```
特殊事件：
- 本週四法說會
- 市場預期 Q4 營收超標
- 注意美股那斯達克走勢影響
```

### 5. 確認送出

點擊 **✅ 確認送出** 或按 **Ctrl+Enter**

系統會將：
- 原始數據（技術面、基本面、法人動向）
- 您的補充說明

一起送給 AI 進行分析。

### 6. AI 分析（流式輸出）

```
⏳ 步驟 3/3: AI 深度分析中 (DeepSeek Chat)...

[分析內容逐字顯示...]

📊 台積電（2330）綜合分析

基於您提供的補充資訊，台積電近期表現強勁...
[AI 會特別考慮您的補充說明]
```

## 使用場景

### 場景 1：加入最新新聞
```bash
/analyze 2330
# 數據確認界面出現
# 補充說明：台積電今日宣布擴廠，法人看好
# AI 會結合新聞做分析
```

### 場景 2：加入個人觀察
```bash
/analyze 2881
# 數據確認界面出現
# 補充說明：今日量價背離，需注意回檔風險
# AI 會特別留意您的觀察
```

### 場景 3：加入產業動態
```bash
/analyze 2454
# 數據確認界面出現
# 補充說明：面板價格持續上漲，產業進入旺季
# AI 會結合產業趨勢分析
```

### 場景 4：純數據分析（不補充）
```bash
/analyze 2317
# 數據確認界面出現
# 直接按確認送出（不輸入補充說明）
# AI 僅用原始數據分析
```

## 快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| `Ctrl+Enter` | 確認送出 |
| `Esc` | 取消分析 |
| `Tab` | 切換焦點 |

## 數據顯示內容

### 📈 股票基本資訊
- 代碼、名稱
- 當前價格、漲跌幅
- 成交量、市值

### 📊 技術面分析
- 趨勢方向
- 技術指標（RSI, MACD, KD 等）
- 支撐壓力位
- 移動平均線位置

### 💼 基本面分析
- 估值指標（P/E, P/B, EPS）
- 獲利能力（ROE, ROA, 毛利率）
- 成長性（營收成長、EPS 成長）
- 財務健康度

### 🏦 法人動向
- 外資買賣超
- 投信買賣超
- 自營商買賣超
- 近期趨勢總結

## 優點

### 1. **提高分析準確性**
- AI 可結合最新資訊
- 您的觀察被納入考量
- 特殊事件不會被忽略

### 2. **增加分析相關性**
- 可針對特定關注點要求分析
- 加入市場氛圍和情緒
- 補充數據未涵蓋的資訊

### 3. **增強控制感**
- 清楚看到送給 AI 的數據
- 可驗證數據正確性
- 隨時可取消不理想的分析

### 4. **學習與記錄**
- 可記錄當時的想法
- 事後回顧決策依據
- 提升投資分析能力

## 補充說明最佳實踐

### ✅ 好的補充說明

**具體且相關**
```
台積電今日法說會表示：
- Q4 營收預估成長 15%
- 3nm 良率達標準
- 明年資本支出維持高檔
```

**有時效性的資訊**
```
重要訊息：
- 美股昨夜大跌 2%，台股今日可能承壓
- 外資期貨淨空單增加 5000 口
```

**個人獨特觀察**
```
盤面觀察：
- 盤中兩次急拉，疑似主力護盤
- 賣壓集中在 585-590 區間
- 下方買盤扎實，支撐強勁
```

### ❌ 較差的補充說明

**太籠統**
```
看起來不錯
```

**無關資訊**
```
我昨天買了這檔
```

**重複數據**
```
RSI 62，MACD 多頭
[這些數據已經在上方顯示]
```

## 取消分析

如果您：
- 發現數據有誤
- 暫時不想分析
- 想重新考慮

可按 `Esc` 或點擊 **❌ 取消** 按鈕。

系統會顯示：
```
❌ 已取消 2330 的分析
```

## 與 AI 的互動

當您添加補充說明後，AI 會：

1. **優先考慮您的觀察**
   ```
   基於您提到的外資連續買超趨勢...
   ```

2. **結合數據與補充說明**
   ```
   技術面顯示突破壓力，配合您提到的法說會利多...
   ```

3. **特別標註相關分析**
   ```
   關於您提到的產業動態，從基本面來看...
   ```

## 實際案例

### 案例 1：結合新聞的深度分析

**輸入：**
```bash
/analyze 2330
```

**補充說明：**
```
今日重要新聞：
1. 台積電宣布亞利桑那州第二座工廠動工
2. 輝達 CEO 訪台，傳將追加 CoWoS 訂單
3. 外資研究報告上調目標價至 680 元
```

**AI 分析結果：**
```
台積電（2330）綜合分析

考量您提供的最新資訊，台積電近期具備多項利多：

1. 擴廠計畫：亞利桑那州第二廠動工，顯示美國客戶訂單能見度高...

2. CoWoS 訂單：若輝達追加訂單，將提升 Q4-Q1 營收動能...

3. 外資看法：目標價上調反映對長期成長的信心...

技術面分析：
- 當前價格 585，接近前波高點 600
- 外資連續買超支撐多頭格局
- 建議突破 600 後追價，停損設 570

[更詳細的分析...]
```

### 案例 2：加入個人觀察

**補充說明：**
```
盤面觀察：
- 今日開高走低，尾盤急拉
- 量能較昨日萎縮 20%
- 外資期貨多單減碼，現貨仍買超
- 580-585 區間有支撐
```

**AI 分析結果：**
```
根據您的盤面觀察，呈現多空交戰格局：

1. 尾盤拉升可能是：
   - 主力護盤動作
   - 被動買盤（如 ETF 調整）
   - 外資現貨持續建倉

2. 量能萎縮需注意：
   - 可能進入整理階段
   - 建議等待放量突破確認

3. 期貨與現貨背離：
   - 短線調節但中長期看多
   - 建議以現貨操作為主

[更詳細的分析...]
```

## 技術細節

### 數據來源
- **股價數據**：yfinance
- **技術指標**：ta-lib
- **基本面**：FinMind / yfinance
- **法人數據**：台灣證交所 API

### AI 模型
支援多種模型：
- DeepSeek Chat（預設）
- Claude Haiku 4 / Sonnet 4
- GPT-4o / GPT-4o Mini
- Gemini 2.0 / 2.5 Flash
- Groq Llama 系列

### 流式輸出
分析過程使用流式輸出，逐字顯示結果，不會感覺當機。

## 常見問題

### Q: 一定要填寫補充說明嗎？
A: 不用，可直接按確認送出。但加入補充說明能讓 AI 分析更準確。

### Q: 補充說明可以寫多長？
A: 建議 50-500 字，太短可能不夠具體，太長可能影響 AI 理解。

### Q: 可以取消後再重新分析嗎？
A: 可以，直接再次執行 `/analyze 2330` 即可。

### Q: 數據有誤可以修改嗎？
A: 目前僅能在補充說明中註明，未來版本會支援直接編輯數據。

### Q: 支援英文補充說明嗎？
A: 支援，中英文皆可，AI 會自動識別。

## 未來規劃

- [ ] 支援直接編輯數據
- [ ] 儲存補充說明模板
- [ ] 歷史補充說明回顧
- [ ] 多股票批量確認
- [ ] 補充說明建議功能

## 總結

數據確認功能讓您在 AI 分析前：
1. ✅ 清楚看到將要分析的數據
2. ✅ 添加最新資訊和個人觀察
3. ✅ 確保分析符合您的需求
4. ✅ 提升分析的準確性和相關性

立即體驗：
```bash
pulse
/analyze 2330
```
